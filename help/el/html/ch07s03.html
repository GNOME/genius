<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Επιστροφή συναρτήσεων</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="Εγχειρίδιο Genius"><link rel="up" href="ch07.html" title="Κεφάλαιο 7. Προχωρημένος προγραμματισμός με GEL"><link rel="prev" href="ch07s02.html" title="Σύνταξη ανωτάτου επιπέδου"><link rel="next" href="ch07s04.html" title="Αληθείς τοπικές μεταβλητές"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Επιστροφή συναρτήσεων</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch07s02.html">Προηγ</a> </td><th width="60%" align="center">Κεφάλαιο 7. Προχωρημένος προγραμματισμός με GEL</th><td width="20%" align="right"> <a accesskey="n" href="ch07s04.html">Επόμενο</a></td></tr></table><hr></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="genius-gel-returning-functions"></a>Επιστροφή συναρτήσεων</h2></div></div></div><p>Είναι δυνατό να επιστρέψετε συναρτήσεις ως τιμή. Με αυτόν τον τρόπο μπορείτε να δομήσετε συναρτήσεις που κατασκευάζουν συναρτήσεις ειδικού σκοπού σύμφωνα με κάποιες παραμέτρους. Το ευαίσθητο κομμάτι είναι τι μεταβλητές βλέπει η συνάρτηση. Ο τρόπος που αυτό δουλεύει στο GEL είναι ότι όταν μια συνάρτηση επιστρέφει μια άλλη συνάρτηση, όλα τα αναγνωριστικά που αναφέρθηκαν στο σώμα της συνάρτησης που βγήκε εκτός εμβέλειας προτάσσουν ένα ιδιωτικό λεξικό της επιστρεφόμενης συνάρτησης. Έτσι η συνάρτηση θα δει όλες τις μεταβλητέςπου ήταν στην εμβέλεια όταν ορίστηκε. Για παράδειγμα, ορίζουμε μια συνάρτηση που επιστρέφει μια συνάρτηση που προσθέτει 5 στο όρισμά της. </p><pre class="programlisting">function f() = (
  k = 5;
  `(x) = (x+k)
)
</pre><p> Σημειώστε ότι, η συνάρτηση προσθέτει τη <code class="varname">k</code> στη <code class="varname">x</code>. Μπορείτε να τη χρησιμοποιήσετε ως εξής. </p><pre class="programlisting">g = f();
g(5)
</pre><p> Και η <strong class="userinput"><code>g(5)</code></strong> πρέπει να επιστρέψει 10.</p><p>Πρέπει να σημειώσετε ότι η τιμή της <code class="varname">k</code> που χρησιμοποιείται είναι αυτή που επιστρέφεται στην πραγματικότητα από την <code class="function">f</code>. Για παράδειγμα: το </p><pre class="programlisting">function f() = (
  k := 5;
  function r(x) = (x+k);
  k := 10;
  r
)
</pre><p> θα επιστρέψει μια συνάρτηση που προσθέτει 10 στο όρισμά της αντί για 5. Αυτό συμβαίνει επειδή το πρόσθετο λεξικό δημιουργείται μόνο όταν το περιεχόμενο στο οποίο η συνάρτηση ορίστηκε τελειώνει, που συμβαίνει όταν η συνάρτηση <code class="function">f</code> επιστρέφεται. Αυτό είναι συνεπές με το πώς θα περιμένατε η συνάρτηση <code class="function">r</code> να δουλέψει μέσα στη συνάρτηση <code class="function">f</code> σύμφωνα με τους κανόνες εμβέλειας των μεταβλητών στη GEL. Μόνο αυτές οι μεταβλητές προστίθενται στο πρόσθετο λεξικό που είναι στο περιεχόμενο που μόλις τελείωσε και δεν υπάρχει πια. Οι χρησιμοποιούμενες μεταβλητές στη συνάρτηση που είναι ακόμα σε έγκυρα περιεχόμενα θα δουλέψουν ως συνήθως, χρησιμοποιώντας την τρέχουσα τιμή της μεταβλητής. Η μόνη διαφορά είναι με τις καθολικές μεταβλητές και συναρτήσεις. Όλα τα αναγνωριστικά που αναφέρθηκαν σε καθολικές μεταβλητές κατά τον ορισμό της συνάρτησης δεν προστίθενται στο ιδιωτικό λεξικό. Αυτό συμβαίνει για να αποφευχθεί πολλή περιττή εργασία κατά την επιστροφή συναρτήσεων και μπορεί σπάνια να είναι πρόβλημα. Για παράδειγμα, ας υποθέσουμε ότι διαγράφετε το "k=5" από τη συνάρτηση <code class="function">f</code> και στο ανώτατο επίπεδο ορίζετε την <code class="varname">k</code> να είναι ας πούμε 5. Τότε όταν εκτελείτε τη <code class="function">f</code>, η συνάρτηση <code class="function">r</code> δεν θα βάλει την <code class="varname">k</code> στο ιδιωτικό λεξικό, επειδή είναι καθολική (ανωτάτου επιπέδου) τη στιγμή του ορισμού της <code class="function">r</code>.</p><p>Μερικές φορές είναι καλύτερο να έχετε περισσότερο έλεγχο στο πώς αντιγράφονται οι μεταβλητές στο ιδιωτικό λεξικό. Από την έκδοση 1.0.7, μπορείτε να ορίσετε ποιες μεταβλητές αντιγράφονται στο ιδιωτικό λεξικό βάζοντας πρόσθετες αγκύλες μετά τα ορίσματα με τον κατάλογο των μεταβλητών να αντιγράφεται χωριζόμενο με κόμματα. Αν το κάνετε αυτό, τότε οι μεταβλητές αντιγράφονται στο προσωπικό λεξικό τη στιγμή του ορισμού της συνάρτησης και το ιδιωτικό λεξικό δεν επηρεάζεται κατόπιν. Για παράδειγμα το </p><pre class="programlisting">function f() = (
  k := 5;
  function r(x) [k] = (x+k);
  k := 10;
  r
)
</pre><p> θα επιστρέψει μια συνάρτηση που όταν καλείται θα προσθέσει 5 στο όρισμά του. Το τοπικό αντίγραφο της <code class="varname">k</code> δημιουργήθηκε όταν η συνάρτηση ορίστηκε.</p><p>Όταν θέλετε η συνάρτηση να μην έχει κανένα ιδιωτικό λεξικό, τότε βάλτε κενές αγκύλες μετά την λίστα ορισμάτων. Τότε κανένα ιδιωτικό λεξικό δεν θα δημιουργηθεί. Κάνοντας το αυξάνετε την αποτελεσματικότητα, όταν ένα προσωπικό λεξικό δεν χρειάζεται ή όταν θέλετε η συνάρτηση να αναζητήσει όλες τις μεταβλητές όπως τις βλέπει όταν καλούνται. Για παράδειγμα ας υποθέσουμε ότι θέλετε η επιστρεφόμενη συνάρτηση από την <code class="function">f</code> να δει την τιμή της <code class="varname">k</code> από το ανώτατο επίπεδο παρά το ότι εκεί είναι μια τοπική μεταβλητή με το ίδιο όνομα κατά τη διάρκεια του ορισμού. Έτσι ο κώδικας </p><pre class="programlisting">function f() = (
  k := 5;
  function r(x) [] = (x+k);
  r
);
k := 10;
g = f();
g(10)
</pre><p> θα επιστρέψει 20 και όχι 15, που θα συμβεί αν η <code class="varname">k</code> με μια τιμή 5 προστέθηκε στο ιδιωτικό λεξικό.</p></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch07s02.html">Προηγ</a> </td><td width="20%" align="center"><a accesskey="u" href="ch07.html">Πάνω</a></td><td width="40%" align="right"> <a accesskey="n" href="ch07s04.html">Επόμενο</a></td></tr><tr><td width="40%" align="left" valign="top">Σύνταξη ανωτάτου επιπέδου </td><td width="20%" align="center"><a accesskey="h" href="index.html">Αρχή</a></td><td width="40%" align="right" valign="top"> Αληθείς τοπικές μεταβλητές</td></tr></table></div></body></html>
